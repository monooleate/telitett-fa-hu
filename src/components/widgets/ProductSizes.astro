---
/**
 * ProductSizes.astro
 * Tel√≠tett c√∂l√∂p m√©retek t√°bl√°zata
 * Felhaszn√°l√°s f√≥kusz, √°r n√©lk√ºl
 * Link a term√©k kateg√≥ri√°ra
 */

import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';

const {
  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;

// C√∂l√∂p m√©retek √©s felhaszn√°l√°suk
const products = [
  // 4 cm √°tm√©r≈ë
  { diameter: 4, length: 100, use: 'Jel√∂l≈ë kar√≥, z√∂lds√©gn√∂v√©nyek', plants: 'Paradicsom, paprika, bab' },
  { diameter: 4, length: 150, use: 'Facsemete, kisebb n√∂v√©nyek', plants: 'Fiatal csemet√©k, bokrok' },
  { diameter: 4, length: 200, use: 'Facsemete, sz≈ël≈ëkar√≥', plants: 'Sz≈ël≈ë, m√°lna, ribizli' },
  { diameter: 4, length: 250, use: 'Kisebb fa t√°masz', plants: '1-2 m magas csemet√©k' },
  
  // 5 cm √°tm√©r≈ë
  { diameter: 5, length: 150, use: 'Facsemete t√°masz', plants: 'Fiatal gy√ºm√∂lcsf√°k' },
  { diameter: 5, length: 200, use: 'Fiatal fa megt√°maszt√°sa', plants: 'Almafa, k√∂rtefa csemete' },
  { diameter: 5, length: 250, use: 'Sz≈ël≈ë, fiatal fa', plants: 'Sz≈ël≈ësor, 2-3 m f√°k' },
  
  // 6 cm √°tm√©r≈ë
  { diameter: 6, length: 100, use: 'R√∂vid jel√∂l≈ë, √°gy√°sszeg√©ly', plants: 'Kerti d√≠sz√≠t√©s' },
  { diameter: 6, length: 150, use: 'Kisebb f√°k t√°maszt√°sa', plants: 'D√≠szcserj√©k, bokorf√°k' },
  { diameter: 6, length: 200, use: 'Gy√ºm√∂lcsfa t√°masz', plants: 'Cseresznye, meggy, szilva' },
  { diameter: 6, length: 250, use: 'K√∂zepes f√°k t√°maszt√°sa', plants: '2-3 m gy√ºm√∂lcsf√°k' },
  { diameter: 6, length: 300, use: 'Nagyobb f√°k, er≈ës sz√©l ellen', plants: 'Di√≥, gesztenye fiatal' },
  
  // 8 cm √°tm√©r≈ë
  { diameter: 8, length: 150, use: 'Er≈ës t√°masz, ker√≠t√©soszlop', plants: 'S√∂v√©ny r√∂gz√≠t√©s' },
  { diameter: 8, length: 200, use: 'K√∂zepes-nagy f√°k', plants: '3-4 m f√°k, h√°rs, juhar' },
  { diameter: 8, length: 250, use: 'Nagyobb f√°k megt√°maszt√°sa', plants: 'T√∂lgy, b√ºkk fiatal' },
  { diameter: 8, length: 300, use: 'Nagy f√°k, parkf√°k', plants: '4-5 m parkf√°k' },
  
  // 10 cm √°tm√©r≈ë
  { diameter: 10, length: 200, use: 'Nagy f√°k, k√∂zter√ºletek', plants: 'Utcai fasorok' },
  { diameter: 10, length: 250, use: 'Igen nagy f√°k t√°maszt√°sa', plants: 'Plat√°n, vadgesztenye' },
  { diameter: 10, length: 300, use: 'Parkf√°k, all√©k', plants: '5+ m nagy lombos f√°k' },
];

const diameters = [...new Set(products.map(p => p.diameter))].sort((a, b) => a - b);
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-5xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <Headline
    title="Melyik M√©retet V√°lasszam?"
    subtitle="Seg√≠t√ºnk kiv√°lasztani a megfelel≈ë c√∂l√∂p√∂t a n√∂v√©ny√©hez"
    tagline="üìè M√©ret Seg√©dlet"
  />

  <div class="mt-8">
    
    <!-- √Åtm√©r≈ë sz≈±r≈ë gombok -->
    <div class="flex flex-wrap justify-center gap-3 mb-6">
      <button 
        class="filter-btn active px-4 py-2 rounded-lg font-semibold transition-all bg-emerald-500 text-white"
        data-filter="all"
      >
        √ñsszes m√©ret
      </button>
      {diameters.map((d) => (
        <button 
          class="filter-btn px-4 py-2 rounded-lg font-semibold transition-all bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-gray-300 hover:bg-emerald-100 dark:hover:bg-emerald-900/40"
          data-filter={d}
        >
          √ò {d} cm
        </button>
      ))}
    </div>

    <!-- T√°bl√°zat -->
    <div class="overflow-x-auto rounded-xl shadow-lg">
      <table class="w-full bg-white dark:bg-slate-800">
        <thead>
          <tr class="bg-emerald-600 dark:bg-emerald-700 text-white">
            <th class="py-4 px-4 text-left font-bold">√Åtm√©r≈ë</th>
            <th class="py-4 px-4 text-left font-bold">Hossz</th>
            <th class="py-4 px-4 text-left font-bold">Felhaszn√°l√°s</th>
            <th class="py-4 px-4 text-left font-bold">Aj√°nlott n√∂v√©nyek</th>
          </tr>
        </thead>
        <tbody id="product-table-body">
          {products.map((product, index) => (
            <tr 
              class={`
                product-row border-b border-gray-100 dark:border-slate-700 
                hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-colors
                ${index % 2 === 0 ? 'bg-gray-50 dark:bg-slate-800/50' : 'bg-white dark:bg-slate-800'}
              `}
              data-diameter={product.diameter}
            >
              <td class="py-3 px-4">
                <span class="inline-flex items-center gap-2">
                  <span class="w-10 h-10 rounded-full bg-emerald-100 dark:bg-emerald-900/50 text-emerald-700 dark:text-emerald-300 flex items-center justify-center font-bold">
                    {product.diameter}
                  </span>
                  <span class="text-gray-500 dark:text-gray-400 text-sm">cm</span>
                </span>
              </td>
              <td class="py-3 px-4">
                <span class="font-semibold text-gray-800 dark:text-gray-200 text-lg">
                  {product.length} cm
                </span>
                <span class="block text-xs text-gray-500 dark:text-gray-400">
                  ({(product.length / 100).toFixed(1)} m)
                </span>
              </td>
              <td class="py-3 px-4">
                <span class="text-gray-700 dark:text-gray-300">
                  {product.use}
                </span>
              </td>
              <td class="py-3 px-4">
                <span class="text-sm text-emerald-600 dark:text-emerald-400 italic">
                  {product.plants}
                </span>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>

    <!-- Tippek -->
    <div class="mt-8 grid md:grid-cols-3 gap-4">
      <div class="bg-blue-50 dark:bg-blue-950/30 rounded-xl p-4 border border-blue-200 dark:border-blue-800">
        <div class="flex items-center gap-2 mb-2">
          <span class="text-2xl">üìè</span>
          <h4 class="font-bold text-blue-800 dark:text-blue-200">√Åtm√©r≈ë Szab√°ly</h4>
        </div>
        <p class="text-sm text-blue-700 dark:text-blue-300">
          A c√∂l√∂p √°tm√©r≈ëje legyen legal√°bb <strong>1/3-a</strong> a fa t√∂rzs√©nek.
        </p>
      </div>
      
      <div class="bg-amber-50 dark:bg-amber-950/30 rounded-xl p-4 border border-amber-200 dark:border-amber-800">
        <div class="flex items-center gap-2 mb-2">
          <span class="text-2xl">üìê</span>
          <h4 class="font-bold text-amber-800 dark:text-amber-200">Hossz√∫s√°g Szab√°ly</h4>
        </div>
        <p class="text-sm text-amber-700 dark:text-amber-300">
          A c√∂l√∂p <strong>1/3-a f√∂ldben</strong>, 2/3-a felette legyen.
        </p>
      </div>
      
      <div class="bg-purple-50 dark:bg-purple-950/30 rounded-xl p-4 border border-purple-200 dark:border-purple-800">
        <div class="flex items-center gap-2 mb-2">
          <span class="text-2xl">üå≥</span>
          <h4 class="font-bold text-purple-800 dark:text-purple-200">Darabsz√°m</h4>
        </div>
        <p class="text-sm text-purple-700 dark:text-purple-300">
          Kis fa: <strong>1-2 c√∂l√∂p</strong>, nagy fa: <strong>2-3 c√∂l√∂p</strong> h√°romsz√∂gben.
        </p>
      </div>
    </div>

    <!-- CTA - Link a c√∂l√∂p√∂k kateg√≥ri√°ra -->
    <div class="mt-10 bg-gradient-to-r from-emerald-500 to-teal-500 dark:from-emerald-600 dark:to-teal-600 rounded-2xl p-8 text-center text-white">
      <h3 class="text-2xl font-bold mb-3">
        Megtal√°lta a megfelel≈ë m√©retet?
      </h3>
      <p class="text-lg opacity-90 mb-6">
        Tekintse meg teljes c√∂l√∂p k√≠n√°latunkat √°rakkal √©s r√©szletes le√≠r√°sokkal!
      </p>
      <a 
        href="/telitett-fa/colopok" 
        class="inline-flex items-center gap-3 bg-white text-emerald-600 font-bold px-8 py-4 rounded-xl hover:bg-emerald-50 transition-colors shadow-lg hover:shadow-xl"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
        </svg>
        C√∂l√∂p√∂k kateg√≥ria b√∂ng√©sz√©se
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
    </div>
  </div>
</WidgetWrapper>

<script is:inline>
  function initProductSizes() {
    const root = document.getElementById('product-sizes');
    if (!root) return;

    // Ne dupl√°zzuk, ha Astro navig√°ci√≥ miatt √∫jra fut
    if (root.dataset.inited === "1") return;
    root.dataset.inited = "1";

    const filterBtns = root.querySelectorAll('.filter-btn');
    const productRows = root.querySelectorAll('.product-row');
    if (!filterBtns.length || !productRows.length) return;

    // Event delegation: 1 listener, stabilabb
    root.addEventListener('click', (e) => {
      const btn = e.target.closest('.filter-btn');
      if (!btn) return;

      const filter = btn.getAttribute('data-filter');

      // Akt√≠v gomb
      filterBtns.forEach(b => {
        b.classList.remove('active', 'bg-emerald-500', 'text-white');
        b.classList.add('bg-gray-100', 'dark:bg-slate-700', 'text-gray-700', 'dark:text-gray-300');
      });
      btn.classList.add('active', 'bg-emerald-500', 'text-white');
      btn.classList.remove('bg-gray-100', 'dark:bg-slate-700', 'text-gray-700', 'dark:text-gray-300');

      // Sz≈±r√©s
      productRows.forEach(row => {
        const diameter = row.getAttribute('data-diameter');
        row.style.display = (filter === 'all' || diameter === filter) ? '' : 'none';
      });
    });

    // ‚úÖ DEFAULT: a 2. gomb legyen alapb√≥l (index 1)
    const defaultBtn = filterBtns[3] || filterBtns[0];
    if (defaultBtn) defaultBtn.click();
  }

  document.addEventListener('DOMContentLoaded', initProductSizes);
  document.addEventListener('astro:page-load', initProductSizes);
  document.addEventListener('astro:after-swap', initProductSizes);
</script>


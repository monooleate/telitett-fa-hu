---
import type { Content as Props } from '~/types';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';
import ItemGrid from '~/components/ui/ItemGrid.astro';

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline = await Astro.slots.render('tagline'),
  content = await Astro.slots.render('content'),
  items = [],
  image = await Astro.slots.render('image'),
  isReversed = false,
  isAfterContent = false,

  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-7xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <div class={`md:flex ${isReversed ? 'md:flex-row-reverse' : ''} md:gap-16`}>
    
    <!-- Text Content -->
    <div class="md:basis-1/2 self-start">
      {
        (title || subtitle || tagline) && (
          <Headline
            title={title}
            subtitle={subtitle}
            tagline={tagline}
            classes={{
              container: 'text-left rtl:text-right mb-4',
              title: 'mb-4 text-3xl sm:text-4xl',
              subtitle: 'mb-8 text-xl',
              ...((classes?.headline as object) ?? {}),
            }}
          />
        )
      }

      <div class="space-y-6">
        {content && <div class="text-gray-700 dark:text-gray-300 prose prose-lg max-w-none" set:html={content} />}

        {
          items && (
            <ItemGrid
              items={items}
              columns={1}
              defaultIcon="tabler:check"
              classes={{
                container: 'gap-y-4',
                panel: 'max-w-none',
                title: 'text-lg font-medium leading-6',
                description: 'text-muted mt-1',
                icon: 'flex h-7 w-7 items-center justify-center rounded-full bg-emerald-600 dark:bg-emerald-700 text-white p-1',
                ...((classes?.items as object) ?? {}),
              }}
            />
          )
        }
      </div>

      {isAfterContent && <Fragment set:html={isAfterContent} />}
    </div>

    <!-- Sticky Image -->
    {
      image && (
        <div class="md:basis-1/2 mt-8 md:mt-0">
          <div class="sticky-image-wrapper sticky top-24">
            <div class="relative h-0 pb-[75%] overflow-hidden rounded-2xl shadow-2xl">
              <Fragment set:html={image} />
            </div>
          </div>
        </div>
      )
    }
  </div>
</WidgetWrapper>

<style>
  .sticky-image-wrapper {
    will-change: transform;
    transition: top 0.1s linear;
  }

  @media (min-width: 768px) {
    .sticky-image-wrapper {
      position: sticky;
      top: 6rem;
    }
  }
</style>

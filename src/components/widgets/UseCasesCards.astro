---
/**
 * UseCasesCards.astro
 * Egyszer≈± k√°rtya carousel - WhatToDeliver st√≠lusban
 * K√©pes h√°tt√©r, automatikus cs√∫sz√°s jobbra, p√∂tty√∂k alul
 */

import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';

const {
  id,
  isDark = false,
  classes = {},
} = Astro.props;

const useCases = [
  {
    title: 'Fa√ºltet√©s',
    subtitle: 'Tart√≥ C√∂l√∂p√∂k',
    description: 'Fiatal f√°k v√©delme √©s t√°maszt√°sa. Ak√°r 25 √©vig tartanak talajban.',
    features: ['UC4 min≈ës√≠t√©s', 'Hegyezett v√©g', '15-25 √©v'],
    href: '/felhasznalasok/faultetes',
    image: 'https://images.unsplash.com/photo-1530836369250-ef72a3f5cda8?w=500&h=350&fit=crop',
    icon: 'üå≥',
    color: 'emerald',
  },
  {
    title: 'Gyermekj√°tsz√≥t√©r',
    subtitle: 'Biztons√°gos',
    description: 'EN 71-3 szabv√°ny, neh√©zf√©m-mentes. K√∂zt√©ri √©s kerti haszn√°latra.',
    features: ['Gyermekbar√°t', 'EN 71-3', 'Neh√©zf√©m-mentes'],
    href: '/felhasznalasok/jatszoter',
    image: 'https://images.unsplash.com/photo-1587616211892-d7a3c0f5f5e8?w=500&h=350&fit=crop',
    icon: 'üé†',
    color: 'purple',
  },
  {
    title: 'Kert√©p√≠t√©s',
    subtitle: 'Pergol√°k & T√°mfalak',
    description: 'Pergol√°k, lugasok, vir√°gl√°d√°k. Tart√≥s kerti √©p√≠tm√©nyek alapanyaga.',
    features: ['Festhet≈ë', 'Id≈ëj√°r√°s√°ll√≥', 'Term√©szetes'],
    href: '/felhasznalasok/kertepites',
    image: 'https://images.unsplash.com/photo-1600585152220-90363fe7e115?w=500&h=350&fit=crop',
    icon: 'üè°',
    color: 'teal',
  },
  {
    title: 'Ker√≠t√©s√©p√≠t√©s',
    subtitle: 'R√∫dfa & Oszlopok',
    description: 'Ker√≠t√©soszlopok, kapuk, l√©cek. A r√∫dfa a legkedveltebb alapanyag.',
    features: ['R√∫dfa v√°laszt√©k', 'F√∂ldbe verhet≈ë', '√âvtizedekig tart'],
    href: '/felhasznalasok/keritesek',
    image: 'https://images.unsplash.com/photo-1600607687920-4e2a09cf159d?w=500&h=350&fit=crop',
    icon: 'üèóÔ∏è',
    color: 'slate',
  },
  {
    title: 'Kerti √âp√≠tm√©nyek',
    subtitle: 'H√°zik√≥k & T√°rol√≥k',
    description: 'Kerti h√°zak, szersz√°mt√°rol√≥k, kutyah√°zak. B√°rmit meg√©p√≠thet!',
    features: ['DIY bar√°t', 'Stabil', 'K√∂nnyen munk√°lhat√≥'],
    href: '/felhasznalasok/kerti-epitmenyek',
    image: 'https://images.unsplash.com/photo-1600566753086-00f18fb6b3ea?w=500&h=350&fit=crop',
    icon: 'üõñ',
    color: 'amber',
  },
  {
    title: 'K√∂zter√ºletek',
    subtitle: 'Parkok & S√©t√°nyok',
    description: '√ñnkorm√°nyzati projektek, parkos√≠t√°s, padok, √∫tjelz≈ëk.',
    features: ['Vand√°lbiztos', 'Professzion√°lis', 'Alacsony karbantart√°s'],
    href: '/felhasznalasok/kozterulet',
    image: 'https://images.unsplash.com/photo-1573204464719-6bbfb61da1ea?w=500&h=350&fit=crop',
    icon: 'üèõÔ∏è',
    color: 'blue',
  },
];

const colorClasses = {
  emerald: { dot: 'bg-emerald-500', badge: 'bg-emerald-500/90' },
  purple: { dot: 'bg-purple-500', badge: 'bg-purple-500/90' },
  teal: { dot: 'bg-teal-500', badge: 'bg-teal-500/90' },
  slate: { dot: 'bg-slate-500', badge: 'bg-slate-500/90' },
  amber: { dot: 'bg-amber-500', badge: 'bg-amber-500/90' },
  blue: { dot: 'bg-blue-500', badge: 'bg-blue-500/90' },
};
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-6xl mx-auto ${classes?.container ?? ''}`}>
  <Headline
    title="Mire Haszn√°lhat√≥ a Tel√≠tett Borovifa?"
    subtitle="Fa√ºltet√©st≈ël j√°tsz√≥terig ‚Äì biztons√°gos, tart√≥s megold√°sok minden k√ºlt√©ri alkalmaz√°shoz"
    tagline="ü™µ Felhaszn√°l√°si Ter√ºletek"
  />

  <div class="mt-10 usecases-carousel">
    
    <!-- K√°rty√°k container -->
    <div class="overflow-hidden">
      <div class="cards-track flex gap-6 transition-transform duration-500 ease-out">
        {useCases.map((item, index) => (
          <a 
            href={item.href}
            class="card flex-shrink-0 w-[280px] md:w-[320px] group"
            data-index={index}
          >
            <div class="relative h-[380px] rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2">
              
              <!-- H√°tt√©rk√©p -->
              <img 
                src={item.image} 
                alt={item.title}
                class="absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                loading="lazy"
              />
              
              <!-- Gradient overlay -->
              <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-black/10"></div>

              <!-- Ikon badge - jobb fels≈ë -->
              <div class="absolute top-4 right-4">
                <div class={`w-14 h-14 ${colorClasses[item.color].badge} backdrop-blur-sm rounded-xl flex items-center justify-center text-3xl shadow-lg transition-transform duration-300 group-hover:scale-110 group-hover:rotate-6`}>
                  {item.icon}
                </div>
              </div>

              <!-- Dekorat√≠v sz√°m - bal fels≈ë -->
              <div class="absolute top-4 left-4 text-8xl font-black text-white/10 leading-none">
                {index + 1}
              </div>

              <!-- Tartalom - alul -->
              <div class="absolute bottom-0 left-0 right-0 p-5">
                
                <!-- Subtitle badge -->
                <span class={`inline-block px-3 py-1 ${colorClasses[item.color].badge} backdrop-blur-sm rounded-full text-white text-xs font-semibold mb-2`}>
                  {item.subtitle}
                </span>

                <!-- C√≠m -->
                <h3 class="text-2xl font-bold text-white mb-2">
                  {item.title}
                </h3>

                <!-- Le√≠r√°s -->
                <p class="text-white/80 text-sm mb-3 line-clamp-2">
                  {item.description}
                </p>

                <!-- Features -->
                <div class="flex flex-wrap gap-1 mb-4">
                  {item.features.slice(0, 2).map((f) => (
                    <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-white/20 backdrop-blur-sm rounded text-white text-xs">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                      {f}
                    </span>
                  ))}
                </div>

                <!-- CTA -->
                <span class="inline-flex items-center gap-2 text-white font-semibold text-sm group-hover:gap-3 transition-all">
                  B√∂ng√©sszen
                  <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                  </svg>
                </span>
              </div>
            </div>
          </a>
        ))}
        
        <!-- Kl√≥nok a v√©gtelen loophoz - els≈ë 3 k√°rtya ism√©tl√©se -->
        {useCases.slice(0, 3).map((item, index) => (
          <a 
            href={item.href}
            class="card card-clone flex-shrink-0 w-[280px] md:w-[320px] group"
            data-index={index}
          >
            <div class="relative h-[380px] rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2">
              <img 
                src={item.image} 
                alt={item.title}
                class="absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                loading="lazy"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-black/10"></div>
              <div class="absolute top-4 right-4">
                <div class={`w-14 h-14 ${colorClasses[item.color].badge} backdrop-blur-sm rounded-xl flex items-center justify-center text-3xl shadow-lg transition-transform duration-300 group-hover:scale-110 group-hover:rotate-6`}>
                  {item.icon}
                </div>
              </div>
              <div class="absolute top-4 left-4 text-8xl font-black text-white/10 leading-none">
                {index + 1}
              </div>
              <div class="absolute bottom-0 left-0 right-0 p-5">
                <span class={`inline-block px-3 py-1 ${colorClasses[item.color].badge} backdrop-blur-sm rounded-full text-white text-xs font-semibold mb-2`}>
                  {item.subtitle}
                </span>
                <h3 class="text-2xl font-bold text-white mb-2">{item.title}</h3>
                <p class="text-white/80 text-sm mb-3 line-clamp-2">{item.description}</p>
                <div class="flex flex-wrap gap-1 mb-4">
                  {item.features.slice(0, 2).map((f) => (
                    <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-white/20 backdrop-blur-sm rounded text-white text-xs">
                      <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                      {f}
                    </span>
                  ))}
                </div>
                <span class="inline-flex items-center gap-2 text-white font-semibold text-sm group-hover:gap-3 transition-all">
                  B√∂ng√©sszen
                  <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                  </svg>
                </span>
              </div>
            </div>
          </a>
        ))}
      </div>
    </div>

    <!-- P√∂tty√∂k -->
    <div class="flex justify-center gap-2 mt-8">
      {useCases.map((item, index) => (
        <button 
          type="button"
          class={`carousel-dot w-2.5 h-2.5 rounded-full transition-all duration-300 ${index === 0 ? 'w-8 ' + colorClasses[item.color].dot : 'bg-gray-300 dark:bg-slate-600 hover:bg-gray-400'}`}
          data-index={index}
          data-color={item.color}
          aria-label={item.title}
        >
        </button>
      ))}
    </div>
  </div>
</WidgetWrapper>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

<script is:inline>
document.addEventListener('DOMContentLoaded', function() {
  var carousel = document.querySelector('.usecases-carousel');
  if (!carousel) return;

  var track = carousel.querySelector('.cards-track');
  var dots = carousel.querySelectorAll('.carousel-dot');
  
  var dotColors = {
    emerald: 'bg-emerald-500',
    purple: 'bg-purple-500',
    teal: 'bg-teal-500',
    slate: 'bg-slate-500',
    amber: 'bg-amber-500',
    blue: 'bg-blue-500'
  };

  var total = 6;
  var current = 0;
  var timer = null;
  var autoplayDelay = 4000;

  function getCardWidth() {
    return window.innerWidth < 768 ? (280 + 24) : (320 + 24);
  }

  function updateDots(index) {
    // Normalize index for dots (0-5)
    var dotIndex = ((index % total) + total) % total;
    dots.forEach(function(dot, i) {
      var color = dot.dataset.color;
      dot.className = 'carousel-dot w-2.5 h-2.5 rounded-full transition-all duration-300';
      if (i === dotIndex) {
        dot.classList.add('w-8', dotColors[color]);
      } else {
        dot.classList.add('bg-gray-300', 'dark:bg-slate-600', 'hover:bg-gray-400');
      }
    });
  }

  function goTo(index, animate) {
    if (animate === undefined) animate = true;
    
    current = index;
    var offset = getCardWidth() * current;
    
    if (animate) {
      track.style.transition = 'transform 0.5s ease-out';
    } else {
      track.style.transition = 'none';
    }
    
    track.style.transform = 'translateX(-' + offset + 'px)';
    updateDots(current);
  }

  function next() {
    current++;
    goTo(current, true);
    
    // Ha el√©rt√ºk a kl√≥nokat, ugorjunk vissza
    if (current >= total) {
      setTimeout(function() {
        goTo(0, false);
      }, 520);
    }
  }

  function prev() {
    current--;
    if (current < 0) {
      // Ugorjunk az utols√≥ra anim√°ci√≥ n√©lk√ºl, majd anim√°ljunk
      goTo(total, false);
      setTimeout(function() {
        current = total - 1;
        goTo(current, true);
      }, 20);
    } else {
      goTo(current, true);
    }
  }

  function startAutoplay() {
    stopAutoplay();
    timer = setInterval(next, autoplayDelay);
  }

  function stopAutoplay() {
    if (timer) { clearInterval(timer); timer = null; }
  }

  // Dot click - adott k√°rty√°ra ugr√°s
  dots.forEach(function(dot, i) {
    dot.addEventListener('click', function() {
      current = i;
      goTo(current, true);
      startAutoplay();
    });
  });

  // Pause on hover
  carousel.addEventListener('mouseenter', stopAutoplay);
  carousel.addEventListener('mouseleave', startAutoplay);

  // Touch swipe
  var touchStartX = 0;
  carousel.addEventListener('touchstart', function(e) {
    touchStartX = e.touches[0].clientX;
    stopAutoplay();
  }, { passive: true });

  carousel.addEventListener('touchend', function(e) {
    var diff = touchStartX - e.changedTouches[0].clientX;
    if (diff > 50) {
      next();
    } else if (diff < -50) {
      prev();
    }
    startAutoplay();
  }, { passive: true });

  // Resize handler
  window.addEventListener('resize', function() {
    goTo(current, false);
  });

  // Init
  goTo(0, false);
  startAutoplay();
});
</script>
